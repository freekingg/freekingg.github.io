<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="1、写在前面Chrome插件是一个用Web技术开发、用来增强浏览器功能的软件,Chrome浏览器扩展开发算是相当简单的，基本只要掌握HTML+CSS+Javascript，即可快速开发一个属于你的Chrome插件！它其实就是一个由HTML、CSS、JS、图片等资源组成的一个.crx后缀的压缩包. 2. 学习Chrome插件开发有什么意义增强浏览器功能，轻松实现属于自己的“定制版”浏览器，等等。 C">
<meta property="og:type" content="article">
<meta property="og:title" content="Chrome插件开发-极速入门教程（必看）">
<meta property="og:url" content="http://yoursite.com/2020/03/30/Chrome%E6%89%A9%E5%B1%95%E5%BC%80%E5%8F%91-%E4%B8%80/index.html">
<meta property="og:site_name" content="记忆的时间差">
<meta property="og:description" content="1、写在前面Chrome插件是一个用Web技术开发、用来增强浏览器功能的软件,Chrome浏览器扩展开发算是相当简单的，基本只要掌握HTML+CSS+Javascript，即可快速开发一个属于你的Chrome插件！它其实就是一个由HTML、CSS、JS、图片等资源组成的一个.crx后缀的压缩包. 2. 学习Chrome插件开发有什么意义增强浏览器功能，轻松实现属于自己的“定制版”浏览器，等等。 C">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/RocWangPeng/king-static/master/20200404113340.png">
<meta property="og:image" content="https://raw.githubusercontent.com/RocWangPeng/king-static/master/20200404113442.png">
<meta property="og:image" content="http://image.liuxianan.com/201706/20170620_195047_992_5668.png">
<meta property="og:image" content="http://image.liuxianan.com/201706/20170619_161102_335_9254.png">
<meta property="og:image" content="http://image.liuxianan.com/201705/20170531_105821_586_0442.png">
<meta property="og:image" content="http://image.liuxianan.com/201705/20170531_105907_256_9087.png">
<meta property="og:image" content="http://image.liuxianan.com/201705/20170531_171447_912_1165.png">
<meta property="og:image" content="https://camo.githubusercontent.com/56178ef13350d7b5ae9e6e46f4d908c3472b1182/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730352f32303137303533315f3130343033385f3230385f393335322e676966">
<meta property="og:image" content="https://camo.githubusercontent.com/ab5bc8d6a1af7a271b30d38da70620bfc8042618/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730352f32303137303533315f3137343031385f3534315f303435312e676966">
<meta property="og:image" content="https://camo.githubusercontent.com/67a5d42b91c9a67b6caeae075c854764805c967f/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730352f32303137303533315f3134353935375f3138335f303532372e706e67">
<meta property="og:image" content="https://camo.githubusercontent.com/8e2153a9c14a4ddf7b745708fd364ecfedb18d99/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730352f32303137303533315f3136303335385f3230325f373234382e706e67">
<meta property="og:image" content="https://camo.githubusercontent.com/82756ac32496b5fe4519594ea29fbc0b7fdb4eed/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730352f32303137303533315f3138303332365f3438375f333339362e706e67">
<meta property="og:image" content="https://camo.githubusercontent.com/9d6cb6e53162c53752211e57e73e0e1579dd162f/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730362f32303137303632315f3137303034365f3834365f353532392e706e67">
<meta property="og:image" content="https://camo.githubusercontent.com/fd33f6c8c1cb6486d56b0cb81c68d5661bc50475/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730362f32303137303632315f3131353930325f3139365f393133302e706e67">
<meta property="og:image" content="http://image.liuxianan.com/201706/20170621_115705_433_5886.png">
<meta property="og:image" content="http://image.liuxianan.com/201706/20170621_115809_750_1163.png">
<meta property="og:image" content="https://camo.githubusercontent.com/f3a8c96d3e0cc02ebccb3c2b815284e7087c1ed3/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730362f32303137303632315f3135353435355f3938305f353335392e676966">
<meta property="og:image" content="https://camo.githubusercontent.com/5198a4fe43e6c8fa790a604d9fc80fcf8ccfe299/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730352f32303137303533315f3139333633335f3336395f303237342e706e67">
<meta property="og:image" content="https://camo.githubusercontent.com/6d7b27fda3d87e0591cf6215065e3fd310caef43/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730362f32303137303630315f3130303230305f3634375f363530372e706e67">
<meta property="og:image" content="https://camo.githubusercontent.com/2a9ba1adb836ce745c9daecfcbc0d8adad898291/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730362f32303137303630315f3130303430385f3333385f333039352e706e67">
<meta property="og:image" content="https://camo.githubusercontent.com/4a44ea082063e77fc60880d8ba050c5c6314135b/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730362f32303137303632315f3138313133305f3336325f333336302e706e67">
<meta property="article:published_time" content="2020-03-30T08:38:38.000Z">
<meta property="article:modified_time" content="2020-03-30T08:38:38.000Z">
<meta property="article:author" content="king">
<meta property="article:tag" content="chrome">
<meta property="article:tag" content="浏览器插件开发">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/RocWangPeng/king-static/master/20200404113340.png">

<link rel="canonical" href="http://yoursite.com/2020/03/30/Chrome%E6%89%A9%E5%B1%95%E5%BC%80%E5%8F%91-%E4%B8%80/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true
  };
</script>

  <title>Chrome插件开发-极速入门教程（必看） | 记忆的时间差</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">记忆的时间差</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">实践是检验真理的唯一标准</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-作品">

    <a href="/project/" rel="section"><i class="fa fa-fw fa-th"></i>作品</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/30/Chrome%E6%89%A9%E5%B1%95%E5%BC%80%E5%8F%91-%E4%B8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/tx.jpg">
      <meta itemprop="name" content="king">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记忆的时间差">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Chrome插件开发-极速入门教程（必看）
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-30 16:38:38" itemprop="dateCreated datePublished" datetime="2020-03-30T16:38:38+08:00">2020-03-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">浏览器插件开发</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              <span>22k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              <span>20 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="1、写在前面"><a href="#1、写在前面" class="headerlink" title="1、写在前面"></a>1、写在前面</h1><p>Chrome插件是一个用Web技术开发、用来增强浏览器功能的软件,Chrome浏览器扩展开发算是相当简单的，基本只要掌握HTML+CSS+Javascript，即可快速开发一个属于你的Chrome插件！它其实就是一个由HTML、CSS、JS、图片等资源组成的一个.crx后缀的压缩包.</p>
<h1 id="2-学习Chrome插件开发有什么意义"><a href="#2-学习Chrome插件开发有什么意义" class="headerlink" title="2. 学习Chrome插件开发有什么意义"></a>2. 学习Chrome插件开发有什么意义</h1><p>增强浏览器功能，轻松实现属于自己的“定制版”浏览器，等等。</p>
<p>Chrome插件提供了很多实用API供我们使用，包括但不限于：</p>
<ul>
<li>书签控制；</li>
<li>下载控制；</li>
<li>窗口控制；</li>
<li>标签控制；</li>
<li>网络请求控制，</li>
<li>各类事件监听；</li>
<li>自定义原生菜单；</li>
<li>完善的通信机制；</li>
<li>等等；</li>
</ul>
<p><strong>详细目录</strong><br><img src="https://raw.githubusercontent.com/RocWangPeng/king-static/master/20200404113340.png" alt=""></p>
<p><strong>demo部分截图：</strong><br><img src="https://raw.githubusercontent.com/RocWangPeng/king-static/master/20200404113442.png" alt=""></p>
<h1 id="3-为什么是Chrome插件而不是Firefox插件"><a href="#3-为什么是Chrome插件而不是Firefox插件" class="headerlink" title="3. 为什么是Chrome插件而不是Firefox插件"></a>3. 为什么是Chrome插件而不是Firefox插件</h1><ul>
<li>Chrome占有率更高，更多人用；</li>
<li>开发更简单；</li>
<li>应用场景更广泛，Firefox插件只能运行在Firefox上，而Chrome除了Chrome浏览器之外，还可以运行在所有webkit内核的国产浏览器，比如360极速浏览器、360安全浏览器、搜狗浏览器、QQ浏览器等等；</li>
<li>除此之外，Firefox浏览器也对Chrome插件的运行提供了一定的支持；</li>
</ul>
<h1 id="4-开发与调试"><a href="#4-开发与调试" class="headerlink" title="4. 开发与调试"></a>4. 开发与调试</h1><p>Chrome插件没有严格的项目结构要求，只要保证本目录有一个manifest.json即可，也不需要专门的IDE，普通的web开发工具即可。<br>从右上角菜单-&gt;更多工具-&gt;扩展程序可以进入 插件管理页面，也可以直接在地址栏输入 chrome://extensions 访问。</p>
<p><img src="http://image.liuxianan.com/201706/20170620_195047_992_5668.png" alt="此处输入图片的描述"></p>
<p>勾选开发者模式即可以文件夹的形式直接加载插件，否则只能安装.crx格式的文件。Chrome要求插件必须从它的Chrome应用商店安装，其它任何网站下载的都无法直接安装，所以，其实我们可以把crx文件解压，然后通过开发者模式直接加载。</p>
<p>开发中，代码有任何改动都必须重新加载插件，只需要在插件管理页按下Ctrl+R即可，以防万一最好还把页面刷新一下。</p>
<h1 id="5-核心介绍"><a href="#5-核心介绍" class="headerlink" title="5. 核心介绍"></a>5. 核心介绍</h1><h2 id="5-1-manifest-json"><a href="#5-1-manifest-json" class="headerlink" title="5.1 manifest.json"></a>5.1 manifest.json</h2><p>这是一个Chrome插件最重要也是必不可少的文件，用来配置所有和插件相关的配置，必须放在根目录。其中，manifest_version、name、version3个是必不可少的，description和icons是推荐的。</p>
<p>下面给出的是一些常见的配置项，均有中文注释，完整的配置文档请戳 <a href="https://developer.chrome.com/extensions/manifest" target="_blank" rel="noopener">这里</a> 。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 清单文件的版本，这个必须写，而且必须是2</span></span><br><span class="line">	<span class="string">"manifest_version"</span>: <span class="number">2</span>,</span><br><span class="line">	<span class="comment">// 插件的名称</span></span><br><span class="line">	<span class="string">"name"</span>: <span class="string">"demo"</span>,</span><br><span class="line">	<span class="comment">// 插件的版本</span></span><br><span class="line">	<span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">	<span class="comment">// 插件描述</span></span><br><span class="line">	<span class="string">"description"</span>: <span class="string">"简单的Chrome扩展demo"</span>,</span><br><span class="line">	<span class="comment">// 图标，一般偷懒全部用一个尺寸的也没问题</span></span><br><span class="line">	<span class="string">"icons"</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">"16"</span>: <span class="string">"img/icon.png"</span>,</span><br><span class="line">		<span class="string">"48"</span>: <span class="string">"img/icon.png"</span>,</span><br><span class="line">		<span class="string">"128"</span>: <span class="string">"img/icon.png"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 会一直常驻的后台JS或后台页面</span></span><br><span class="line">	<span class="string">"background"</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 2种指定方式，如果指定JS，那么会自动生成一个背景页</span></span><br><span class="line">		<span class="string">"page"</span>: <span class="string">"background.html"</span></span><br><span class="line">		<span class="comment">//"scripts": ["js/background.js"]</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 浏览器右上角图标设置，browser_action、page_action、app必须三选一</span></span><br><span class="line">	<span class="string">"browser_action"</span>: </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">"default_icon"</span>: <span class="string">"img/icon.png"</span>,</span><br><span class="line">		<span class="comment">// 图标悬停时的标题，可选</span></span><br><span class="line">		<span class="string">"default_title"</span>: <span class="string">"这是一个示例Chrome插件"</span>,</span><br><span class="line">		<span class="string">"default_popup"</span>: <span class="string">"popup.html"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 当某些特定页面打开才显示的图标</span></span><br><span class="line">	<span class="comment">/*"page_action":</span></span><br><span class="line"><span class="comment">	&#123;</span></span><br><span class="line"><span class="comment">		"default_icon": "img/icon.png",</span></span><br><span class="line"><span class="comment">		"default_title": "我是pageAction",</span></span><br><span class="line"><span class="comment">		"default_popup": "popup.html"</span></span><br><span class="line"><span class="comment">	&#125;,*/</span></span><br><span class="line">	<span class="comment">// 需要直接注入页面的JS</span></span><br><span class="line">	<span class="string">"content_scripts"</span>: </span><br><span class="line">	[</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//"matches": ["http://*/*", "https://*/*"],</span></span><br><span class="line">			<span class="comment">// "&lt;all_urls&gt;" 表示匹配所有地址</span></span><br><span class="line">			<span class="string">"matches"</span>: [<span class="string">"&lt;all_urls&gt;"</span>],</span><br><span class="line">			<span class="comment">// 多个JS按顺序注入</span></span><br><span class="line">			<span class="string">"js"</span>: [<span class="string">"js/jquery-1.8.3.js"</span>, <span class="string">"js/content-script.js"</span>],</span><br><span class="line">			<span class="comment">// JS的注入可以随便一点，但是CSS的注意就要千万小心了，因为一不小心就可能影响全局样式</span></span><br><span class="line">			<span class="string">"css"</span>: [<span class="string">"css/custom.css"</span>],</span><br><span class="line">			<span class="comment">// 代码注入的时间，可选值： "document_start", "document_end", or "document_idle"，最后一个表示页面空闲时，默认document_idle</span></span><br><span class="line">			<span class="string">"run_at"</span>: <span class="string">"document_start"</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="comment">// 这里仅仅是为了演示content-script可以配置多个规则</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">"matches"</span>: [<span class="string">"*://*/*.png"</span>, <span class="string">"*://*/*.jpg"</span>, <span class="string">"*://*/*.gif"</span>, <span class="string">"*://*/*.bmp"</span>],</span><br><span class="line">			<span class="string">"js"</span>: [<span class="string">"js/show-image-content-size.js"</span>]</span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="comment">// 权限申请</span></span><br><span class="line">	<span class="string">"permissions"</span>:</span><br><span class="line">	[</span><br><span class="line">		<span class="string">"contextMenus"</span>, <span class="comment">// 右键菜单</span></span><br><span class="line">		<span class="string">"tabs"</span>, <span class="comment">// 标签</span></span><br><span class="line">		<span class="string">"notifications"</span>, <span class="comment">// 通知</span></span><br><span class="line">		<span class="string">"webRequest"</span>, <span class="comment">// web请求</span></span><br><span class="line">		<span class="string">"webRequestBlocking"</span>,</span><br><span class="line">		<span class="string">"storage"</span>, <span class="comment">// 插件本地存储</span></span><br><span class="line">		<span class="string">"http://*/*"</span>, <span class="comment">// 可以通过executeScript或者insertCSS访问的网站</span></span><br><span class="line">		<span class="string">"https://*/*"</span> <span class="comment">// 可以通过executeScript或者insertCSS访问的网站</span></span><br><span class="line">	],</span><br><span class="line">	<span class="comment">// 普通页面能够直接访问的插件资源列表，如果不设置是无法直接访问的</span></span><br><span class="line">	<span class="string">"web_accessible_resources"</span>: [<span class="string">"js/inject.js"</span>],</span><br><span class="line">	<span class="comment">// 插件主页，这个很重要，不要浪费了这个免费广告位</span></span><br><span class="line">	<span class="string">"homepage_url"</span>: <span class="string">"https://www.baidu.com"</span>,</span><br><span class="line">	<span class="comment">// 覆盖浏览器默认页面</span></span><br><span class="line">	<span class="string">"chrome_url_overrides"</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 覆盖浏览器默认的新标签页</span></span><br><span class="line">		<span class="string">"newtab"</span>: <span class="string">"newtab.html"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// Chrome40以前的插件配置页写法</span></span><br><span class="line">	<span class="string">"options_page"</span>: <span class="string">"options.html"</span>,</span><br><span class="line">	<span class="comment">// Chrome40以后的插件配置页写法，如果2个都写，新版Chrome只认后面这一个</span></span><br><span class="line">	<span class="string">"options_ui"</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">"page"</span>: <span class="string">"options.html"</span>,</span><br><span class="line">		<span class="comment">// 添加一些默认的样式，推荐使用</span></span><br><span class="line">		<span class="string">"chrome_style"</span>: <span class="literal">true</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">// 向地址栏注册一个关键字以提供搜索建议，只能设置一个关键字</span></span><br><span class="line">	<span class="string">"omnibox"</span>: &#123; <span class="string">"keyword"</span> : <span class="string">"go"</span> &#125;,</span><br><span class="line">	<span class="comment">// 默认语言</span></span><br><span class="line">	<span class="string">"default_locale"</span>: <span class="string">"zh_CN"</span>,</span><br><span class="line">	<span class="comment">// devtools页面入口，注意只能指向一个HTML文件，不能是JS文件</span></span><br><span class="line">	<span class="string">"devtools_page"</span>: <span class="string">"devtools.html"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-content-scripts"><a href="#5-2-content-scripts" class="headerlink" title="5.2 content-scripts"></a>5.2 content-scripts</h2><p>所谓content-scripts，其实就是Chrome插件中向页面注入脚本的一种形式（虽然名为script，其实还可以包括css的），借助content-scripts我们可以实现通过配置的方式轻松向指定页面注入JS和CSS（如果需要动态注入，可以参考下文），最常见的比如：广告屏蔽、页面CSS定制，等等。</p>
<p>示例配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 需要直接注入页面的JS</span></span><br><span class="line">	<span class="string">"content_scripts"</span>: </span><br><span class="line">	[</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">//"matches": ["http://*/*", "https://*/*"],</span></span><br><span class="line">			<span class="comment">// "&lt;all_urls&gt;" 表示匹配所有地址</span></span><br><span class="line">			<span class="string">"matches"</span>: [<span class="string">"&lt;all_urls&gt;"</span>],</span><br><span class="line">			<span class="comment">// 多个JS按顺序注入</span></span><br><span class="line">			<span class="string">"js"</span>: [<span class="string">"js/jquery-1.8.3.js"</span>, <span class="string">"js/content-script.js"</span>],</span><br><span class="line">			<span class="comment">// JS的注入可以随便一点，但是CSS的注意就要千万小心了，因为一不小心就可能影响全局样式</span></span><br><span class="line">			<span class="string">"css"</span>: [<span class="string">"css/custom.css"</span>],</span><br><span class="line">			<span class="comment">// 代码注入的时间，可选值： "document_start", "document_end", or "document_idle"，最后一个表示页面空闲时，默认document_idle</span></span><br><span class="line">			<span class="string">"run_at"</span>: <span class="string">"document_start"</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>特别注意，如果没有主动指定run_at为document_start（默认为document_idle），下面这种代码是不会生效的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'DOMContentLoaded'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'我被执行了！'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>content-scripts和原始页面共享DOM，但是不共享JS，如要访问页面JS（例如某个JS变量），只能通过injected js来实现。content-scripts不能访问绝大部分chrome.xxx.api，除了下面这4种：</p>
<ul>
<li>chrome.extension(getURL , inIncognitoContext , lastError , onRequest , sendRequest)</li>
<li>chrome.i18n</li>
<li>chrome.runtime(connect , getManifest , getURL , id , onConnect , onMessage , sendMessage)</li>
<li>chrome.storage</li>
</ul>
<p>其实看到这里不要悲观，这些API绝大部分时候都够用了，非要调用其它API的话，你还可以通过通信来实现让background来帮你调用（关于通信，后文有详细介绍）。</p>
<p>好了，Chrome插件给我们提供了这么强大的JS注入功能，剩下的就是发挥你的想象力去玩弄浏览器了。</p>
<h2 id="5-3-background"><a href="#5-3-background" class="headerlink" title="5.3 background"></a>5.3 background</h2><p>后台（姑且这么翻译吧），是一个常驻的页面，它的生命周期是插件中所有类型页面中最长的，它随着浏览器的打开而打开，随着浏览器的关闭而关闭，所以通常把需要一直运行的、启动就运行的、全局的代码放在background里面。</p>
<p>background的权限非常高，几乎可以调用所有的Chrome扩展API（除了devtools），而且它可以无限制跨域，也就是可以跨域访问任何网站而无需要求对方设置CORS。</p>
<blockquote>
<p>经过测试，其实不止是background，所有的直接通过chrome-extension://id/xx.html这种方式打开的网页都可以无限制跨域。</p>
</blockquote>
<p>配置中，background可以通过page指定一张网页，也可以通过scripts直接指定一个JS，Chrome会自动为这个JS生成一个默认的网页：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 会一直常驻的后台JS或后台页面</span></span><br><span class="line">	<span class="string">"background"</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 2种指定方式，如果指定JS，那么会自动生成一个背景页</span></span><br><span class="line">		<span class="string">"page"</span>: <span class="string">"background.html"</span></span><br><span class="line">		<span class="comment">//"scripts": ["js/background.js"]</span></span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-4-event-pages"><a href="#5-4-event-pages" class="headerlink" title="5.4 event-pages"></a>5.4 event-pages</h2><p>这里顺带介绍一下event-pages，它是一个什么东西呢？鉴于background生命周期太长，长时间挂载后台可能会影响性能，所以Google又弄一个event-pages，在配置文件上，它与background的唯一区别就是多了一个persistent参数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">"background"</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">"scripts"</span>: [<span class="string">"event-page.js"</span>],</span><br><span class="line">		<span class="string">"persistent"</span>: <span class="literal">false</span></span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它的生命周期是：在被需要时加载，在空闲时被关闭，什么叫被需要时呢？比如第一次安装、插件更新、有content-script向它发送消息，等等。</p>
<p>除了配置文件的变化，代码上也有一些细微变化，个人这个简单了解一下就行了，一般情况下background也不会很消耗性能的。</p>
<h2 id="5-5-popup"><a href="#5-5-popup" class="headerlink" title="5.5 popup"></a>5.5 popup</h2><p>popup是点击browser_action或者page_action图标时打开的一个小窗口网页，焦点离开网页就立即关闭，一般用来做一些临时性的交互。</p>
<p><img src="http://image.liuxianan.com/201706/20170619_161102_335_9254.png" alt="此处输入图片的描述"></p>
<p>popup可以包含任意你想要的HTML内容，并且会自适应大小。可以通过default_popup字段来指定popup页面，也可以调用setPopup()方法。</p>
<p>配置方式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">"browser_action"</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">"default_icon"</span>: <span class="string">"img/icon.png"</span>,</span><br><span class="line">		<span class="comment">// 图标悬停时的标题，可选</span></span><br><span class="line">		<span class="string">"default_title"</span>: <span class="string">"这是一个示例Chrome插件"</span>,</span><br><span class="line">		<span class="string">"default_popup"</span>: <span class="string">"popup.html"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要特别注意的是，由于单击图标打开popup，焦点离开又立即关闭，所以popup页面的生命周期一般很短，需要长时间运行的代码千万不要写在popup里面。</p>
<p>在权限上，它和background非常类似，它们之间最大的不同是生命周期的不同，popup中可以直接通过chrome.extension.getBackgroundPage()获取background的window对象。</p>
<h2 id="5-6-injected-script"><a href="#5-6-injected-script" class="headerlink" title="5.6 injected-script"></a>5.6 injected-script</h2><p>这里的injected-script是我给它取的，指的是通过DOM操作的方式向页面注入的一种JS。为什么要把这种JS单独拿出来讨论呢？又或者说为什么需要通过这种方式注入JS呢？</p>
<p>这是因为content-script有一个很大的“缺陷”，也就是无法访问页面中的JS，虽然它可以操作DOM，但是DOM却不能调用它，也就是无法在DOM中通过绑定事件的方式调用content-script中的代码（包括直接写onclick和addEventListener2种方式都不行），但是，“在页面上添加一个按钮并调用插件的扩展API”是一个很常见的需求，那该怎么办呢？其实这就是本小节要讲的。</p>
<p>在content-script中通过DOM方式向页面注入inject-script代码示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 向页面注入JS</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">injectCustomJs</span>(<span class="params">jsPath</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	jsPath = jsPath || <span class="string">'js/inject.js'</span>;</span><br><span class="line">	<span class="keyword">var</span> temp = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">	temp.setAttribute(<span class="string">'type'</span>, <span class="string">'text/javascript'</span>);</span><br><span class="line">	<span class="comment">// 获得的地址类似：chrome-extension://ihcokhadfjfchaeagdoclpnjdiokfakg/js/inject.js</span></span><br><span class="line">	temp.src = chrome.extension.getURL(jsPath);</span><br><span class="line">	temp.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// 放在页面不好看，执行完后移除掉</span></span><br><span class="line">		<span class="keyword">this</span>.parentNode.removeChild(<span class="keyword">this</span>);</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="built_in">document</span>.head.appendChild(temp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你以为这样就行了？执行一下你会看到如下报错：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Denying load <span class="keyword">of</span> chrome-extension:<span class="comment">//efbllncjkjiijkppagepehoekjojdclc/js/inject.js. Resources must be listed in the web_accessible_resources manifest key in order to be loaded by pages outside the extension.</span></span><br></pre></td></tr></table></figure>
<p>意思就是你想要在web中直接访问插件中的资源的话必须显示声明才行，配置文件中增加如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 普通页面能够直接访问的插件资源列表，如果不设置是无法直接访问的</span></span><br><span class="line">	<span class="string">"web_accessible_resources"</span>: [<span class="string">"js/inject.js"</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至于inject-script如何调用content-script中的代码，后面我会在专门的一个消息通信章节详细介绍。</p>
<h2 id="5-7-homepage-url"><a href="#5-7-homepage-url" class="headerlink" title="5.7 homepage_url"></a>5.7 homepage_url</h2><p>开发者或者插件主页设置，一般会在如下2个地方显示：<br><img src="http://image.liuxianan.com/201705/20170531_105821_586_0442.png" alt="此处输入图片的描述"></p>
<p><img src="http://image.liuxianan.com/201705/20170531_105907_256_9087.png" alt="此处输入图片的描述"></p>
<h1 id="6-Chrome插件的8种展示形式"><a href="#6-Chrome插件的8种展示形式" class="headerlink" title="6. Chrome插件的8种展示形式"></a>6. Chrome插件的8种展示形式</h1><h2 id="6-1-browserAction-浏览器右上角"><a href="#6-1-browserAction-浏览器右上角" class="headerlink" title="6.1. browserAction(浏览器右上角)"></a>6.1. browserAction(浏览器右上角)</h2><p>通过配置browser_action可以在浏览器的右上角增加一个图标，一个browser_action可以拥有一个图标，一个tooltip，一个badge和一个popup。</p>
<p>示例配置如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"browser_action"</span>:</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"default_icon"</span>: <span class="string">"img/icon.png"</span>,</span><br><span class="line">	<span class="string">"default_title"</span>: <span class="string">"这是一个示例Chrome插件"</span>,</span><br><span class="line">	<span class="string">"default_popup"</span>: <span class="string">"popup.html"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-1-1-图标"><a href="#6-1-1-图标" class="headerlink" title="6.1.1. 图标"></a>6.1.1. 图标</h3><p>browser_action图标推荐使用宽高都为19像素的图片，更大的图标会被缩小，格式随意，一般推荐png，可以通过manifest中default_icon字段配置，也可以调用setIcon()方法。</p>
<h3 id="6-1-2-tooltip"><a href="#6-1-2-tooltip" class="headerlink" title="6.1.2. tooltip"></a>6.1.2. tooltip</h3><p>修改browser_action的manifest中default_title字段，或者调用setTitle()方法。</p>
<h3 id="6-1-3-badge"><a href="#6-1-3-badge" class="headerlink" title="6.1.3. badge"></a>6.1.3. badge</h3><p>所谓badge就是在图标上显示一些文本，可以用来更新一些小的扩展状态提示信息。因为badge空间有限，所以只支持4个以下的字符（英文4个，中文2个）。badge无法通过配置文件来指定，必须通过代码实现，设置badge文字和颜色可以分别使用setBadgeText()和setBadgeBackgroundColor()。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chrome.browserAction.setBadgeText(&#123;<span class="attr">text</span>: <span class="string">'new'</span>&#125;);</span><br><span class="line">chrome.browserAction.setBadgeBackgroundColor(&#123;<span class="attr">color</span>: [<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>]&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="http://image.liuxianan.com/201705/20170531_171447_912_1165.png" alt="此处输入图片的描述"></p>
<h2 id="6-2-pageAction-地址栏右侧"><a href="#6-2-pageAction-地址栏右侧" class="headerlink" title="6.2 pageAction(地址栏右侧)"></a>6.2 pageAction(地址栏右侧)</h2><p>pageAction和普通的browserAction一样也是放在浏览器右上角，只不过没有点亮时是灰色的，点亮了才是彩色的，灰色时无论左键还是右键单击都是弹出选项：</p>
<p><img src="https://camo.githubusercontent.com/56178ef13350d7b5ae9e6e46f4d908c3472b1182/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730352f32303137303533315f3130343033385f3230385f393335322e676966" alt="此处输入图片的描述"></p>
<p>调整之后的pageAction我们可以简单地把它看成是可以置灰的browserAction。</p>
<ul>
<li>chrome.pageAction.show(tabId) 显示图标；</li>
<li>chrome.pageAction.hide(tabId) 隐藏图标；</li>
</ul>
<p>示例 : (只有打开百度才显示图标)：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// manifest.json</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"page_action"</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">"default_icon"</span>: <span class="string">"img/icon.png"</span>,</span><br><span class="line">		<span class="string">"default_title"</span>: <span class="string">"我是pageAction"</span>,</span><br><span class="line">		<span class="string">"default_popup"</span>: <span class="string">"popup.html"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="string">"permissions"</span>: [<span class="string">"declarativeContent"</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line">chrome.runtime.onInstalled.addListener(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	chrome.declarativeContent.onPageChanged.removeRules(<span class="literal">undefined</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		chrome.declarativeContent.onPageChanged.addRules([</span><br><span class="line">			&#123;</span><br><span class="line">				conditions: [</span><br><span class="line">					<span class="comment">// 只有打开百度才显示pageAction</span></span><br><span class="line">					<span class="keyword">new</span> chrome.declarativeContent.PageStateMatcher(&#123;<span class="attr">pageUrl</span>: &#123;<span class="attr">urlContains</span>: <span class="string">'baidu.com'</span>&#125;&#125;)</span><br><span class="line">				],</span><br><span class="line">				actions: [<span class="keyword">new</span> chrome.declarativeContent.ShowPageAction()]</span><br><span class="line">			&#125;</span><br><span class="line">		]);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>效果图：</p>
<p><img src="https://camo.githubusercontent.com/ab5bc8d6a1af7a271b30d38da70620bfc8042618/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730352f32303137303533315f3137343031385f3534315f303435312e676966" alt="此处输入图片的描述"></p>
<h2 id="6-3-右键菜单"><a href="#6-3-右键菜单" class="headerlink" title="6.3 右键菜单"></a>6.3 右键菜单</h2><p>通过开发Chrome插件可以自定义浏览器的右键菜单，主要是通过chrome.contextMenusAPI实现，右键菜单可以出现在不同的上下文，比如普通页面、选中的文字、图片、链接，等等</p>
<h3 id="6-3-1-最简单的右键菜单示例"><a href="#6-3-1-最简单的右键菜单示例" class="headerlink" title="6.3.1 最简单的右键菜单示例"></a>6.3.1 最简单的右键菜单示例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// manifest.json</span></span><br><span class="line">&#123;<span class="string">"permissions"</span>: [<span class="string">"contextMenus"</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line">chrome.contextMenus.create(&#123;</span><br><span class="line">	title: <span class="string">"测试右键菜单"</span>,</span><br><span class="line">	onclick: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(<span class="string">'您点击了右键菜单！'</span>);&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>效果：<br><img src="https://camo.githubusercontent.com/67a5d42b91c9a67b6caeae075c854764805c967f/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730352f32303137303533315f3134353935375f3138335f303532372e706e67" alt="此处输入图片的描述"></p>
<p>添加右键百度搜索</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// manifest.json</span></span><br><span class="line">&#123;<span class="string">"permissions"</span>: [<span class="string">"contextMenus"</span>， <span class="string">"tabs"</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line">chrome.contextMenus.create(&#123;</span><br><span class="line">	title: <span class="string">'使用度娘搜索：%s'</span>, <span class="comment">// %s表示选中的文字</span></span><br><span class="line">	contexts: [<span class="string">'selection'</span>], <span class="comment">// 只有当选中文字时才会出现此右键菜单</span></span><br><span class="line">	onclick: <span class="function"><span class="keyword">function</span>(<span class="params">params</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// 注意不能使用location.href，因为location是属于background的window对象</span></span><br><span class="line">		chrome.tabs.create(&#123;<span class="attr">url</span>: <span class="string">'https://www.baidu.com/s?ie=utf-8&amp;wd='</span> + <span class="built_in">encodeURI</span>(params.selectionText)&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>效果如下：<br><img src="https://camo.githubusercontent.com/8e2153a9c14a4ddf7b745708fd364ecfedb18d99/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730352f32303137303533315f3136303335385f3230325f373234382e706e67" alt="此处输入图片的描述"></p>
<h3 id="6-3-2-右键菜单语法说明"><a href="#6-3-2-右键菜单语法说明" class="headerlink" title="6.3.2 右键菜单语法说明"></a>6.3.2 右键菜单语法说明</h3><p>这里只是简单列举一些常用的，完整API参见：<a href="https://developer.chrome.com/extensions/contextMenus" target="_blank" rel="noopener">https://developer.chrome.com/extensions/contextMenus</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">chrome.contextMenus.create(&#123;</span><br><span class="line">	type: <span class="string">'normal'</span>， <span class="comment">// 类型，可选：["normal", "checkbox", "radio", "separator"]，默认 normal</span></span><br><span class="line">	title: <span class="string">'菜单的名字'</span>, <span class="comment">// 显示的文字，除非为“separator”类型否则此参数必需，如果类型为“selection”，可以使用%s显示选定的文本</span></span><br><span class="line">	contexts: [<span class="string">'page'</span>], <span class="comment">// 上下文环境，可选：["all", "page", "frame", "selection", "link", "editable", "image", "video", "audio"]，默认page</span></span><br><span class="line">	onclick: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;, <span class="comment">// 单击时触发的方法</span></span><br><span class="line">	parentId: <span class="number">1</span>, <span class="comment">// 右键菜单项的父菜单项ID。指定父菜单项将会使此菜单项成为父菜单项的子菜单</span></span><br><span class="line">	documentUrlPatterns: <span class="string">'https://*.baidu.com/*'</span> <span class="comment">// 只在某些页面显示此右键菜单</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 删除某一个菜单项</span></span><br><span class="line">chrome.contextMenus.remove(menuItemId)；</span><br><span class="line"><span class="comment">// 删除所有自定义右键菜单</span></span><br><span class="line">chrome.contextMenus.removeAll();</span><br><span class="line"><span class="comment">// 更新某一个菜单项</span></span><br><span class="line">chrome.contextMenus.update(menuItemId, updateProperties);</span><br></pre></td></tr></table></figure>
<p>###6.4. override(覆盖特定页面)<br>使用<code>override</code>页可以将Chrome默认的一些特定页面替换掉，改为使用扩展提供的页面。</p>
<p>扩展可以替代如下页面：</p>
<ul>
<li>历史记录：从工具菜单上点击历史记录时访问的页面，或者从地址栏直接输入 chrome://history</li>
<li>新标签页：当创建新标签的时候访问的页面，或者从地址栏直接输入 chrome://newtab</li>
<li>书签：浏览器的书签，或者直接输入 chrome://bookmarks</li>
</ul>
<p>注意：</p>
<ul>
<li>一个扩展只能替代一个页面；</li>
<li>不能替代隐身窗口的新标签页；</li>
<li>网页必须设置title，否则用户可能会看到网页的URL，造成困扰；</li>
</ul>
<p>下面的截图是默认的新标签页和被扩展替换掉的新标签页。<br><img src="https://camo.githubusercontent.com/82756ac32496b5fe4519594ea29fbc0b7fdb4eed/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730352f32303137303533315f3138303332365f3438375f333339362e706e67" alt="此处输入图片的描述"></p>
<p>代码（注意，一个插件只能替代一个默认页，以下仅为演示）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"chrome_url_overrides"</span>:</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"newtab"</span>: <span class="string">"newtab.html"</span>,</span><br><span class="line">	<span class="string">"history"</span>: <span class="string">"history.html"</span>,</span><br><span class="line">	<span class="string">"bookmarks"</span>: <span class="string">"bookmarks.html"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-5-option-选项页"><a href="#6-5-option-选项页" class="headerlink" title="6.5 option(选项页)"></a>6.5 option(选项页)</h3><p>所谓<code>options</code>页，就是插件的设置页面，有2个入口，一个是右键图标有一个“选项”菜单，还有一个在插件管理页面：<br><img src="https://camo.githubusercontent.com/9d6cb6e53162c53752211e57e73e0e1579dd162f/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730362f32303137303632315f3137303034365f3834365f353532392e706e67" alt="此处输入图片的描述"></p>
<p><img src="https://camo.githubusercontent.com/fd33f6c8c1cb6486d56b0cb81c68d5661bc50475/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730362f32303137303632315f3131353930325f3139365f393133302e706e67" alt="此处输入图片的描述"></p>
<p>在Chrome40以前，options页面和其它普通页面没什么区别，Chrome40以后则有了一些变化。</p>
<p>我们先看老版的 <a href="https://developer.chrome.com/extensions/options" target="_blank" rel="noopener">options</a>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// Chrome40以前的插件配置页写法</span></span><br><span class="line">	<span class="string">"ptions_page"</span>: <span class="string">"options.html"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个页面里面的内容就随你自己发挥了，配置之后在插件管理页就会看到一个选项按钮入口，点进去就是打开一个网页，没啥好讲的。</p>
<p>效果:</p>
<p><img src="http://image.liuxianan.com/201706/20170621_115705_433_5886.png" alt="此处输入图片的描述"></p>
<p>再来看新版的<a href="https://developer.chrome.com/extensions/optionsV2" target="_blank" rel="noopener">optionsV2：</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  &#123;</span><br><span class="line">	<span class="string">"options_ui"</span>:</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="string">"page"</span>: <span class="string">"options.html"</span>,</span><br><span class="line">		<span class="comment">// 添加一些默认的样式，推荐使用</span></span><br><span class="line">		<span class="string">"chrome_style"</span>: <span class="literal">true</span></span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>options.html</code> 的代码我们没有任何改动，只是配置文件改了，之后效果如下：</p>
<p><img src="http://image.liuxianan.com/201706/20170621_115809_750_1163.png" alt="此处输入图片的描述"></p>
<p>看起来是不是高大上了？</p>
<p>几点注意：</p>
<ul>
<li>为了兼容，建议2种都写，如果都写了，Chrome40以后会默认读取新版的方式；</li>
<li>新版options中不能使用alert；</li>
<li>数据存储建议用chrome.storage，因为会随用户自动同步；<h3 id="6-5-omnibox"><a href="#6-5-omnibox" class="headerlink" title="6.5 omnibox"></a>6.5 omnibox</h3><code>omnibox</code>是向用户提供搜索建议的一种方式。先来看个gif图以便了解一下这东西到底是个什么鬼：<br><img src="https://camo.githubusercontent.com/f3a8c96d3e0cc02ebccb3c2b815284e7087c1ed3/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730362f32303137303632315f3135353435355f3938305f353335392e676966" alt="此处输入图片的描述"></li>
</ul>
<p>注册某个关键字以触发插件自己的搜索建议界面，然后可以任意发挥了。</p>
<p>首先，配置文件如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 向地址栏注册一个关键字以提供搜索建议，只能设置一个关键字</span></span><br><span class="line">	<span class="string">"omnibox"</span>: &#123; <span class="string">"keyword"</span> : <span class="string">"go"</span> &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后background.js中注册监听事件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// omnibox 演示</span></span><br><span class="line">chrome.omnibox.onInputChanged.addListener(<span class="function">(<span class="params">text, suggest</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'inputChanged: '</span> + text);</span><br><span class="line">	<span class="keyword">if</span>(!text) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span>(text == <span class="string">'美女'</span>) &#123;</span><br><span class="line">		suggest([</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">'中国'</span> + text, <span class="attr">description</span>: <span class="string">'你要找“中国美女”吗？'</span>&#125;,</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">'日本'</span> + text, <span class="attr">description</span>: <span class="string">'你要找“日本美女”吗？'</span>&#125;,</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">'泰国'</span> + text, <span class="attr">description</span>: <span class="string">'你要找“泰国美女或人妖”吗？'</span>&#125;,</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">'韩国'</span> + text, <span class="attr">description</span>: <span class="string">'你要找“韩国美女”吗？'</span>&#125;</span><br><span class="line">		]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(text == <span class="string">'微博'</span>) &#123;</span><br><span class="line">		suggest([</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">'新浪'</span> + text, <span class="attr">description</span>: <span class="string">'新浪'</span> + text&#125;,</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">'腾讯'</span> + text, <span class="attr">description</span>: <span class="string">'腾讯'</span> + text&#125;,</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">'搜狐'</span> + text, <span class="attr">description</span>: <span class="string">'搜索'</span> + text&#125;,</span><br><span class="line">		]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		suggest([</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">'百度搜索 '</span> + text, <span class="attr">description</span>: <span class="string">'百度搜索 '</span> + text&#125;,</span><br><span class="line">			&#123;<span class="attr">content</span>: <span class="string">'谷歌搜索 '</span> + text, <span class="attr">description</span>: <span class="string">'谷歌搜索 '</span> + text&#125;,</span><br><span class="line">		]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当用户接收关键字建议时触发</span></span><br><span class="line">chrome.omnibox.onInputEntered.addListener(<span class="function">(<span class="params">text</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'inputEntered: '</span> + text);</span><br><span class="line">	<span class="keyword">if</span>(!text) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">var</span> href = <span class="string">''</span>;</span><br><span class="line">	<span class="keyword">if</span>(text.endsWith(<span class="string">'美女'</span>)) href = <span class="string">'http://image.baidu.com/search/index?tn=baiduimage&amp;ie=utf-8&amp;word='</span> + text;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(text.startsWith(<span class="string">'百度搜索'</span>)) href = <span class="string">'https://www.baidu.com/s?ie=UTF-8&amp;wd='</span> + text.replace(<span class="string">'百度搜索 '</span>, <span class="string">''</span>);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(text.startsWith(<span class="string">'谷歌搜索'</span>)) href = <span class="string">'https://www.google.com.tw/search?q='</span> + text.replace(<span class="string">'谷歌搜索 '</span>, <span class="string">''</span>);</span><br><span class="line">	<span class="keyword">else</span> href = <span class="string">'https://www.baidu.com/s?ie=UTF-8&amp;wd='</span> + text;</span><br><span class="line">	openUrlCurrentTab(href);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 获取当前选项卡ID</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCurrentTabId</span>(<span class="params">callback</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	chrome.tabs.query(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">tabs</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(callback) callback(tabs.length ? tabs[<span class="number">0</span>].id: <span class="literal">null</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前标签打开某个链接</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">openUrlCurrentTab</span>(<span class="params">url</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	getCurrentTabId(<span class="function"><span class="params">tabId</span> =&gt;</span> &#123;</span><br><span class="line">		chrome.tabs.update(tabId, &#123;<span class="attr">url</span>: url&#125;);</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-6-桌面通知"><a href="#6-6-桌面通知" class="headerlink" title="6.6 桌面通知"></a>6.6 桌面通知</h3><p>Chrome提供了一个chrome.notificationsAPI以便插件推送桌面通知，暂未找到chrome.notifications和HTML5自带的Notification的显著区别及优势。</p>
<p>在后台JS中，无论是使用chrome.notifications还是Notification都不需要申请权限（HTML5方式需要申请权限），直接使用即可。</p>
<p>最简单的通知：</p>
<p><img src="https://camo.githubusercontent.com/5198a4fe43e6c8fa790a604d9fc80fcf8ccfe299/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730352f32303137303533315f3139333633335f3336395f303237342e706e67" alt="此处输入图片的描述"></p>
<p>代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chrome.notifications.create(<span class="literal">null</span>, &#123;</span><br><span class="line">	type: <span class="string">'basic'</span>,</span><br><span class="line">	iconUrl: <span class="string">'img/icon.png'</span>,</span><br><span class="line">	title: <span class="string">'这是标题'</span>,</span><br><span class="line">	message: <span class="string">'您刚才点击了自定义右键菜单！'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="7-五种类型的JS对比"><a href="#7-五种类型的JS对比" class="headerlink" title="7. 五种类型的JS对比"></a>7. 五种类型的JS对比</h1><p>Chrome插件的JS主要可以分为这5类：<code>injected script</code>、<code>content-script</code>、<code>popup js</code>、<code>background js</code>和<code>devtools js</code>，</p>
<h3 id="7-1-权限对比"><a href="#7-1-权限对比" class="headerlink" title="7.1. 权限对比"></a>7.1. 权限对比</h3><table>
<thead>
<tr>
<th align="center">JS种类</th>
<th align="center">可访问的API</th>
<th align="center">DOM访问情况</th>
<th align="center">JS访问情况</th>
<th align="center">直接跨域</th>
</tr>
</thead>
<tbody><tr>
<td align="center">injected script</td>
<td align="center">和普通JS无任何差别，不能访问任何扩展API</td>
<td align="center">可以</td>
<td align="center">可以</td>
<td align="center">不可以</td>
</tr>
<tr>
<td align="center">content script</td>
<td align="center">只能访问 extension、runtime等部分API</td>
<td align="center">可以</td>
<td align="center">不可以</td>
<td align="center">不可以</td>
</tr>
<tr>
<td align="center">popup js</td>
<td align="center">可访问绝大部分API，除了devtools系列</td>
<td align="center">不可直接访问</td>
<td align="center">不可以</td>
<td align="center">不可以</td>
</tr>
<tr>
<td align="center">background js</td>
<td align="center">可访问绝大部分API，除了devtools系列</td>
<td align="center">不可直接访问</td>
<td align="center">不可以</td>
<td align="center">不可以</td>
</tr>
<tr>
<td align="center">devtools js</td>
<td align="center">只能访问 devtools、extension、runtime等部分API</td>
<td align="center">可以</td>
<td align="center">可以</td>
<td align="center">不可以</td>
</tr>
</tbody></table>
<h1 id="8-消息通信"><a href="#8-消息通信" class="headerlink" title="8. 消息通信"></a>8. 消息通信</h1><p>通信主页：<a href="https://developer.chrome.com/extensions/messaging" target="_blank" rel="noopener">https://developer.chrome.com/extensions/messaging</a><br>前面我们介绍了Chrome插件中存在的5种JS，那么它们之间如何互相通信呢？下面先来系统概况一下，然后再分类细说。需要知道的是，popup和background其实几乎可以视为一种东西，因为它们可访问的API都一样、通信机制一样、都可以跨域。</p>
<h2 id="8-1-互相通信概览"><a href="#8-1-互相通信概览" class="headerlink" title="8.1 互相通信概览"></a>8.1 互相通信概览</h2><p>注：<code>-</code>表示不存在或者无意义，或者待验证。<br>|  -  | injected-script   |  content-script  |  popup-js  | background-js  |<br>| :—–:  |:—:  |:—:  |:—:  |:—:  |<br>| injected-script | - |window.postMessage | - |-|<br>| content-script | window.postMessage |- | chrome.runtime.sendMessage chrome.runtime.connect |chrome.runtime.sendMessage chrome.runtime.connect|<br>| popup-js | - |chrome.tabs.sendMessage chrome.tabs.connect | - |chrome.extension. getBackgroundPage()|<br>|background-js|-|chrome.tabs.sendMessage chrome.tabs.connect|chrome.extension.getViews|-|<br>|devtools-js|chrome.devtools. inspectedWindow.eval|-|chrome.runtime.sendMessage    |chrome.runtime.sendMessage    |</p>
<h2 id="8-2-通信详细介绍"><a href="#8-2-通信详细介绍" class="headerlink" title="8.2 通信详细介绍"></a>8.2 通信详细介绍</h2><h3 id="8-2-1-popup和background"><a href="#8-2-1-popup和background" class="headerlink" title="8.2.1 popup和background"></a>8.2.1 popup和background</h3><p>popup可以直接调用background中的JS方法，也可以直接访问background的DOM：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// background.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	alert(<span class="string">'我是background！'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// popup.js</span></span><br><span class="line"><span class="keyword">var</span> bg = chrome.extension.getBackgroundPage();</span><br><span class="line">bg.test(); <span class="comment">// 访问bg的函数</span></span><br><span class="line">alert(bg.document.body.innerHTML); <span class="comment">// 访问bg的DOM</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>小插曲，今天碰到一个情况，发现popup无法获取background的任何方法，找了半天才发现是因为background的js报错了，而你如果不主动查看background的js的话，是看不到错误信息的，特此提醒。</p>
</blockquote>
<p>至于background访问popup如下（前提是popup已经打开）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> views = chrome.extension.getViews(&#123;<span class="attr">type</span>:<span class="string">'popup'</span>&#125;);</span><br><span class="line"><span class="keyword">if</span>(views.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">	<span class="built_in">console</span>.log(views[<span class="number">0</span>].location.href);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-2-2-popup或者bg向content主动发送消息"><a href="#8-2-2-popup或者bg向content主动发送消息" class="headerlink" title="8.2.2 popup或者bg向content主动发送消息"></a>8.2.2 popup或者bg向content主动发送消息</h3><p>background.js或者popup.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendMessageToContentScript</span>(<span class="params">message, callback</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	chrome.tabs.query(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">tabs</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		chrome.tabs.sendMessage(tabs[<span class="number">0</span>].id, message, <span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(callback) callback(response);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line">sendMessageToContentScript(&#123;<span class="attr">cmd</span>:<span class="string">'test'</span>, <span class="attr">value</span>:<span class="string">'你好，我是popup！'</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'来自content的回复：'</span>+response);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>content-script.js</code> 接收：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onMessage.addListener(<span class="function"><span class="keyword">function</span>(<span class="params">request, sender, sendResponse</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// console.log(sender.tab ?"from a content script:" + sender.tab.url :"from the extension");</span></span><br><span class="line">	<span class="keyword">if</span>(request.cmd == <span class="string">'test'</span>) alert(request.value);</span><br><span class="line">	sendResponse(<span class="string">'我收到了你的消息！'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>双方通信直接发送的都是JSON对象，不是JSON字符串，所以无需解析，很方便（当然也可以直接发送字符串）。</p>
<blockquote>
<p>网上有些老代码中用的是chrome.extension.onMessage，没有完全查清二者的区别(貌似是别名)，但是建议统一使用chrome.runtime.onMessage。</p>
</blockquote>
<h3 id="8-2-3-content-script主动发消息给后台"><a href="#8-2-3-content-script主动发消息给后台" class="headerlink" title="8.2.3 content-script主动发消息给后台"></a>8.2.3 content-script主动发消息给后台</h3><p>content-script.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.sendMessage(&#123;<span class="attr">greeting</span>: <span class="string">'你好，我是content-script呀，我主动发消息给后台！'</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'收到来自后台的回复：'</span> + response);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>background.js 或者 popup.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听来自content-script的消息</span></span><br><span class="line">chrome.runtime.onMessage.addListener(<span class="function"><span class="keyword">function</span>(<span class="params">request, sender, sendResponse</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'收到来自content-script的消息：'</span>);</span><br><span class="line">	<span class="built_in">console</span>.log(request, sender, sendResponse);</span><br><span class="line">	sendResponse(<span class="string">'我是后台，我已收到你的消息：'</span> + <span class="built_in">JSON</span>.stringify(request));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>注意事项：</p>
<ul>
<li>content_scripts向popup主动发消息的前提是popup必须打开！否则需要利用background作中转；</li>
<li>如果background和popup同时监听，那么它们都可以同时收到消息，但是只有一个可以sendResponse，一个先发送了，那么另外一个再发送就无效；</li>
</ul>
<h3 id="8-2-4-injected-script和content-script"><a href="#8-2-4-injected-script和content-script" class="headerlink" title="8.2.4 injected script和content-script"></a>8.2.4 injected script和content-script</h3><p>content-script和页面内的脚本（injected-script自然也属于页面内的脚本）之间唯一共享的东西就是页面的DOM元素，有2种方法可以实现二者通讯：</p>
<ul>
<li>可以通过window.postMessage和window.addEventListener来实现二者消息通讯；</li>
<li>通过自定义DOM事件来实现；</li>
</ul>
<p>第一种方法（推荐）：<br><code>injected-script</code>中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.postMessage(&#123;<span class="string">"test"</span>: <span class="string">'你好！'</span>&#125;, <span class="string">'*'</span>);</span><br></pre></td></tr></table></figure>
<p><code>content script</code>中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"message"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(e.data);</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<p>第二种方法：<br><code>injected-script</code>中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> customEvent = <span class="built_in">document</span>.createEvent(<span class="string">'Event'</span>);</span><br><span class="line">customEvent.initEvent(<span class="string">'myCustomEvent'</span>, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fireCustomEvent</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">	hiddenDiv = <span class="built_in">document</span>.getElementById(<span class="string">'myCustomEventDiv'</span>);</span><br><span class="line">	hiddenDiv.innerText = data</span><br><span class="line">	hiddenDiv.dispatchEvent(customEvent);</span><br><span class="line">&#125;</span><br><span class="line">fireCustomEvent(<span class="string">'你好，我是普通JS！'</span>);</span><br></pre></td></tr></table></figure>
<p><code>content-script.js</code>中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hiddenDiv = <span class="built_in">document</span>.getElementById(<span class="string">'myCustomEventDiv'</span>);</span><br><span class="line"><span class="keyword">if</span>(!hiddenDiv) &#123;</span><br><span class="line">	hiddenDiv = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">	hiddenDiv.style.display = <span class="string">'none'</span>;</span><br><span class="line">	<span class="built_in">document</span>.body.appendChild(hiddenDiv);</span><br><span class="line">&#125;</span><br><span class="line">hiddenDiv.addEventListener(<span class="string">'myCustomEvent'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> eventData = <span class="built_in">document</span>.getElementById(<span class="string">'myCustomEventDiv'</span>).innerText;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'收到自定义事件消息：'</span> + eventData);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="8-3-长连接和短连接"><a href="#8-3-长连接和短连接" class="headerlink" title="8.3 长连接和短连接"></a>8.3 长连接和短连接</h3><p>其实上面已经涉及到了，这里再单独说明一下。Chrome插件中有2种通信方式，一个是短连接（chrome.tabs.sendMessage和chrome.runtime.sendMessage），一个是长连接（chrome.tabs.connect和chrome.runtime.connect）。</p>
<p>短连接的话就是挤牙膏一样，我发送一下，你收到了再回复一下，如果对方不回复，你只能重新发，而长连接类似WebSocket会一直建立连接，双方可以随时互发消息。</p>
<p>短连接上面已经有代码示例了，这里只讲一下长连接。</p>
<p>popup.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">getCurrentTabId(<span class="function">(<span class="params">tabId</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> port = chrome.tabs.connect(tabId, &#123;<span class="attr">name</span>: <span class="string">'test-connect'</span>&#125;);</span><br><span class="line">	port.postMessage(&#123;<span class="attr">question</span>: <span class="string">'你是谁啊？'</span>&#125;);</span><br><span class="line">	port.onMessage.addListener(<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">		alert(<span class="string">'收到消息：'</span>+msg.answer);</span><br><span class="line">		<span class="keyword">if</span>(msg.answer &amp;&amp; msg.answer.startsWith(<span class="string">'我是'</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			port.postMessage(&#123;<span class="attr">question</span>: <span class="string">'哦，原来是你啊！'</span>&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>content-script.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听长连接</span></span><br><span class="line">chrome.runtime.onConnect.addListener(<span class="function"><span class="keyword">function</span>(<span class="params">port</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(port);</span><br><span class="line">	<span class="keyword">if</span>(port.name == <span class="string">'test-connect'</span>) &#123;</span><br><span class="line">		port.onMessage.addListener(<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">			<span class="built_in">console</span>.log(<span class="string">'收到长连接消息：'</span>, msg);</span><br><span class="line">			<span class="keyword">if</span>(msg.question == <span class="string">'你是谁啊？'</span>) port.postMessage(&#123;<span class="attr">answer</span>: <span class="string">'我是你爸！'</span>&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="9-其它补充"><a href="#9-其它补充" class="headerlink" title="9. 其它补充"></a>9. 其它补充</h1><h2 id="9-1-动态注入或执行JS"><a href="#9-1-动态注入或执行JS" class="headerlink" title="9.1 动态注入或执行JS"></a>9.1 动态注入或执行JS</h2><p>虽然在background和popup中无法直接访问页面DOM，但是可以通过chrome.tabs.executeScript来执行脚本，从而实现访问web页面的DOM（注意，这种方式也不能直接访问页面JS）。</p>
<p>示例manifest.json配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">"name"</span>: <span class="string">"动态JS注入演示"</span>,</span><br><span class="line">	...</span><br><span class="line">	<span class="string">"permissions"</span>: [</span><br><span class="line">		<span class="string">"tabs"</span>, <span class="string">"http://*/*"</span>, <span class="string">"https://*/*"</span></span><br><span class="line">	],</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JS：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动态执行JS代码</span></span><br><span class="line">chrome.tabs.executeScript(tabId, &#123;<span class="attr">code</span>: <span class="string">'document.body.style.backgroundColor="red"'</span>&#125;);</span><br><span class="line"><span class="comment">// 动态执行JS文件</span></span><br><span class="line">chrome.tabs.executeScript(tabId, &#123;<span class="attr">file</span>: <span class="string">'some-script.js'</span>&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="9-2-动态注入CSS"><a href="#9-2-动态注入CSS" class="headerlink" title="9.2 动态注入CSS"></a>9.2 动态注入CSS</h2><p>示例manifest.json配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">"name"</span>: <span class="string">"动态CSS注入演示"</span>,</span><br><span class="line">	...</span><br><span class="line">	<span class="string">"permissions"</span>: [</span><br><span class="line">		<span class="string">"tabs"</span>, <span class="string">"http://*/*"</span>, <span class="string">"https://*/*"</span></span><br><span class="line">	],</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JS代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动态执行CSS代码，TODO，这里有待验证</span></span><br><span class="line">chrome.tabs.insertCSS(tabId, &#123;<span class="attr">code</span>: <span class="string">'xxx'</span>&#125;);</span><br><span class="line"><span class="comment">// 动态执行CSS文件</span></span><br><span class="line">chrome.tabs.insertCSS(tabId, &#123;<span class="attr">file</span>: <span class="string">'some-style.css'</span>&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="9-3-获取当前窗口ID"><a href="#9-3-获取当前窗口ID" class="headerlink" title="9.3 获取当前窗口ID"></a>9.3 获取当前窗口ID</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chrome.windows.getCurrent(<span class="function"><span class="keyword">function</span>(<span class="params">currentWindow</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'当前窗口ID：'</span> + currentWindow.id);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="9-4-获取当前标签页ID"><a href="#9-4-获取当前标签页ID" class="headerlink" title="9.4 获取当前标签页ID"></a>9.4 获取当前标签页ID</h2><p>一般有2种方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取当前选项卡ID</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCurrentTabId</span>(<span class="params">callback</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	chrome.tabs.query(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">currentWindow</span>: <span class="literal">true</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">tabs</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(callback) callback(tabs.length ? tabs[<span class="number">0</span>].id: <span class="literal">null</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>获取当前选项卡id的另一种方法，大部分时候都类似，只有少部分时候会不一样（例如当窗口最小化时）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取当前选项卡ID</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCurrentTabId2</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	chrome.windows.getCurrent(<span class="function"><span class="keyword">function</span>(<span class="params">currentWindow</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		chrome.tabs.query(&#123;<span class="attr">active</span>: <span class="literal">true</span>, <span class="attr">windowId</span>: currentWindow.id&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">tabs</span>)</span></span><br><span class="line"><span class="function">		</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(callback) callback(tabs.length ? tabs[<span class="number">0</span>].id: <span class="literal">null</span>);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-5-本地存储"><a href="#9-5-本地存储" class="headerlink" title="9.5 本地存储"></a>9.5 本地存储</h2><p>本地存储建议用chrome.storage而不是普通的localStorage，区别有好几点，个人认为最重要的2点区别是</p>
<ul>
<li>chrome.storage是针对插件全局的，即使你在background中保存的数据，在content-script也能获取到；</li>
<li>chrome.storage.sync可以跟随当前登录用户自动同步，这台电脑修改的设置会自动同步到其它电脑，很方便，如果没有登录或者未联网则先保存到本地，等登录了再同步至网络；</li>
</ul>
<p>需要声明storage权限，有chrome.storage.sync和chrome.storage.local2种方式可供选择，使用示例如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取数据，第一个参数是指定要读取的key以及设置默认值</span></span><br><span class="line">chrome.storage.sync.get(&#123;<span class="attr">color</span>: <span class="string">'red'</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">items</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(items.color, items.age);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 保存数据</span></span><br><span class="line">chrome.storage.sync.set(&#123;<span class="attr">color</span>: <span class="string">'blue'</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'保存成功！'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="9-6-webRequest"><a href="#9-6-webRequest" class="headerlink" title="9.6 webRequest"></a>9.6 webRequest</h2><p>通过webRequest系列API可以对HTTP请求进行任性地修改、定制，这里通过beforeRequest来简单演示一下它的冰山一角：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//manifest.json</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// 权限申请</span></span><br><span class="line">	<span class="string">"permissions"</span>:</span><br><span class="line">	[</span><br><span class="line">		<span class="string">"webRequest"</span>, <span class="comment">// web请求</span></span><br><span class="line">		<span class="string">"webRequestBlocking"</span>, <span class="comment">// 阻塞式web请求</span></span><br><span class="line">		<span class="string">"storage"</span>, <span class="comment">// 插件本地存储</span></span><br><span class="line">		<span class="string">"http://*/*"</span>, <span class="comment">// 可以通过executeScript或者insertCSS访问的网站</span></span><br><span class="line">		<span class="string">"https://*/*"</span> <span class="comment">// 可以通过executeScript或者insertCSS访问的网站</span></span><br><span class="line">	],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line"><span class="comment">// 是否显示图片</span></span><br><span class="line"><span class="keyword">var</span> showImage;</span><br><span class="line">chrome.storage.sync.get(&#123;<span class="attr">showImage</span>: <span class="literal">true</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">items</span>) </span>&#123;</span><br><span class="line">	showImage = items.showImage;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// web请求监听，最后一个参数表示阻塞式，需单独声明权限：webRequestBlocking</span></span><br><span class="line">chrome.webRequest.onBeforeRequest.addListener(<span class="function"><span class="params">details</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// cancel 表示取消本次请求</span></span><br><span class="line">	<span class="keyword">if</span>(!showImage &amp;&amp; details.type == <span class="string">'image'</span>) <span class="keyword">return</span> &#123;<span class="attr">cancel</span>: <span class="literal">true</span>&#125;;</span><br><span class="line">	<span class="comment">// 简单的音视频检测</span></span><br><span class="line">	<span class="comment">// 大部分网站视频的type并不是media，且视频做了防下载处理，所以这里仅仅是为了演示效果，无实际意义</span></span><br><span class="line">	<span class="keyword">if</span>(details.type == <span class="string">'media'</span>) &#123;</span><br><span class="line">		chrome.notifications.create(<span class="literal">null</span>, &#123;</span><br><span class="line">			type: <span class="string">'basic'</span>,</span><br><span class="line">			iconUrl: <span class="string">'img/icon.png'</span>,</span><br><span class="line">			title: <span class="string">'检测到音视频'</span>,</span><br><span class="line">			message: <span class="string">'音视频地址：'</span> + details.url,</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;, &#123;<span class="attr">urls</span>: [<span class="string">"&lt;all_urls&gt;"</span>]&#125;, [<span class="string">"blocking"</span>]);</span><br></pre></td></tr></table></figure>
<h2 id="9-7-API总结"><a href="#9-7-API总结" class="headerlink" title="9.7 API总结"></a>9.7 API总结</h2><p>比较常用用的一些API系列：</p>
<ul>
<li>chrome.tabs</li>
<li>chrome.runtime</li>
<li>chrome.webRequest</li>
<li>chrome.window</li>
<li>chrome.storage</li>
<li>chrome.contextMenus</li>
<li>chrome.devtools</li>
<li>chrome.extension<h1 id="10-经验总结"><a href="#10-经验总结" class="headerlink" title="10. 经验总结"></a>10. 经验总结</h1><h2 id="10-1-查看已安装插件路径"><a href="#10-1-查看已安装插件路径" class="headerlink" title="10.1 查看已安装插件路径"></a>10.1 查看已安装插件路径</h2>已安装的插件源码路径：C:\Users\用户名\AppData\Local\Google\Chrome\User Data\Default\Extensions，每一个插件被放在以插件ID为名的文件夹里面，想要学习某个插件的某个功能是如何实现的，看人家的源码是最好的方法了：<br><img src="https://camo.githubusercontent.com/6d7b27fda3d87e0591cf6215065e3fd310caef43/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730362f32303137303630315f3130303230305f3634375f363530372e706e67" alt="此处输入图片的描述"></li>
</ul>
<p>如何查看某个插件的ID？进入 chrome://extensions ，然后勾线开发者模式即可看到了。<br><img src="https://camo.githubusercontent.com/2a9ba1adb836ce745c9daecfcbc0d8adad898291/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730362f32303137303630315f3130303430385f3333385f333039352e706e67" alt="此处输入图片的描述"></p>
<h2 id="10-2-特别注意background的报错"><a href="#10-2-特别注意background的报错" class="headerlink" title="10.2 特别注意background的报错"></a>10.2 特别注意background的报错</h2><p>很多时候你发现你的代码会莫名其妙的失效，找来找去又找不到原因，这时打开background的控制台才发现原来某个地方写错了导致代码没生效，正式由于background报错的隐蔽性(需要主动打开对应的控制台才能看到错误)，所以特别注意这点。</p>
<h1 id="11-打包与发布"><a href="#11-打包与发布" class="headerlink" title="11. 打包与发布"></a>11. 打包与发布</h1><p>打包的话直接在插件管理页有一个打包按钮：<br><img src="https://camo.githubusercontent.com/4a44ea082063e77fc60880d8ba050c5c6314135b/687474703a2f2f696d6167652e6c69757869616e616e2e636f6d2f3230313730362f32303137303632315f3138313133305f3336325f333336302e706e67" alt="此处输入图片的描述"></p>
<p>然后会生成一个.crx文件</p>
<h1 id="12-参考"><a href="#12-参考" class="headerlink" title="12. 参考"></a>12. 参考</h1><h2 id="官方资料"><a href="#官方资料" class="headerlink" title="官方资料"></a>官方资料</h2><p>推荐查看官方文档，虽然是英文，但是全且新，国内的中文资料都比较旧（注意以下全部需要翻墙）：</p>
<ul>
<li><a href="https://developer.chrome.com/extensions" target="_blank" rel="noopener">Chrome插件官方文档主页</a></li>
<li><a href="https://developer.chrome.com/extensions/samples" target="_blank" rel="noopener">Chrome插件官方示例</a></li>
<li><a href="https://developer.chrome.com/extensions/manifest" target="_blank" rel="noopener">manifest清单文件</a></li>
<li><a href="https://developer.chrome.com/extensions/permissions" target="_blank" rel="noopener">permissions权限</a></li>
<li>chrome.xxx.api文档</li>
<li>模糊匹配规则语法详解</li>
</ul>
<h1 id="Chrome扩展demo"><a href="#Chrome扩展demo" class="headerlink" title="Chrome扩展demo"></a>Chrome扩展demo</h1><p><a href="https://github.com/RocWangPeng/chrome-plugin-demo" target="_blank" rel="noopener">https://github.com/RocWangPeng/chrome-plugin-demo</a></p>
<p>原文参考自:<a href="http://blog.haoji.me/chrome-plugin-develop.html?from=xa" target="_blank" rel="noopener">好记的博客</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/chrome/" rel="tag"># chrome</a>
              <a href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/" rel="tag"># 浏览器插件开发</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/03/30/axios-%E5%A4%A7%E4%BC%97%E7%89%88%E5%B0%81%E8%A3%85/" rel="prev" title="axios-大众版封装">
      <i class="fa fa-chevron-left"></i> axios-大众版封装
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/03/30/mongoose%E5%85%A5%E9%97%A8/" rel="next" title="mongoose入门">
      mongoose入门 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1、写在前面"><span class="nav-number">1.</span> <span class="nav-text">1、写在前面</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-学习Chrome插件开发有什么意义"><span class="nav-number">2.</span> <span class="nav-text">2. 学习Chrome插件开发有什么意义</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-为什么是Chrome插件而不是Firefox插件"><span class="nav-number">3.</span> <span class="nav-text">3. 为什么是Chrome插件而不是Firefox插件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-开发与调试"><span class="nav-number">4.</span> <span class="nav-text">4. 开发与调试</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-核心介绍"><span class="nav-number">5.</span> <span class="nav-text">5. 核心介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-manifest-json"><span class="nav-number">5.1.</span> <span class="nav-text">5.1 manifest.json</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-content-scripts"><span class="nav-number">5.2.</span> <span class="nav-text">5.2 content-scripts</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-background"><span class="nav-number">5.3.</span> <span class="nav-text">5.3 background</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-event-pages"><span class="nav-number">5.4.</span> <span class="nav-text">5.4 event-pages</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-5-popup"><span class="nav-number">5.5.</span> <span class="nav-text">5.5 popup</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-6-injected-script"><span class="nav-number">5.6.</span> <span class="nav-text">5.6 injected-script</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-7-homepage-url"><span class="nav-number">5.7.</span> <span class="nav-text">5.7 homepage_url</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-Chrome插件的8种展示形式"><span class="nav-number">6.</span> <span class="nav-text">6. Chrome插件的8种展示形式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-browserAction-浏览器右上角"><span class="nav-number">6.1.</span> <span class="nav-text">6.1. browserAction(浏览器右上角)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-1-图标"><span class="nav-number">6.1.1.</span> <span class="nav-text">6.1.1. 图标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-2-tooltip"><span class="nav-number">6.1.2.</span> <span class="nav-text">6.1.2. tooltip</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-3-badge"><span class="nav-number">6.1.3.</span> <span class="nav-text">6.1.3. badge</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-pageAction-地址栏右侧"><span class="nav-number">6.2.</span> <span class="nav-text">6.2 pageAction(地址栏右侧)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-右键菜单"><span class="nav-number">6.3.</span> <span class="nav-text">6.3 右键菜单</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-1-最简单的右键菜单示例"><span class="nav-number">6.3.1.</span> <span class="nav-text">6.3.1 最简单的右键菜单示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-2-右键菜单语法说明"><span class="nav-number">6.3.2.</span> <span class="nav-text">6.3.2 右键菜单语法说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-5-option-选项页"><span class="nav-number">6.3.3.</span> <span class="nav-text">6.5 option(选项页)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-5-omnibox"><span class="nav-number">6.3.4.</span> <span class="nav-text">6.5 omnibox</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-6-桌面通知"><span class="nav-number">6.3.5.</span> <span class="nav-text">6.6 桌面通知</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-五种类型的JS对比"><span class="nav-number">7.</span> <span class="nav-text">7. 五种类型的JS对比</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-权限对比"><span class="nav-number">7.0.1.</span> <span class="nav-text">7.1. 权限对比</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-消息通信"><span class="nav-number">8.</span> <span class="nav-text">8. 消息通信</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-互相通信概览"><span class="nav-number">8.1.</span> <span class="nav-text">8.1 互相通信概览</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-通信详细介绍"><span class="nav-number">8.2.</span> <span class="nav-text">8.2 通信详细介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-1-popup和background"><span class="nav-number">8.2.1.</span> <span class="nav-text">8.2.1 popup和background</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-2-popup或者bg向content主动发送消息"><span class="nav-number">8.2.2.</span> <span class="nav-text">8.2.2 popup或者bg向content主动发送消息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-3-content-script主动发消息给后台"><span class="nav-number">8.2.3.</span> <span class="nav-text">8.2.3 content-script主动发消息给后台</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-4-injected-script和content-script"><span class="nav-number">8.2.4.</span> <span class="nav-text">8.2.4 injected script和content-script</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-长连接和短连接"><span class="nav-number">8.2.5.</span> <span class="nav-text">8.3 长连接和短连接</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-其它补充"><span class="nav-number">9.</span> <span class="nav-text">9. 其它补充</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-1-动态注入或执行JS"><span class="nav-number">9.1.</span> <span class="nav-text">9.1 动态注入或执行JS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-2-动态注入CSS"><span class="nav-number">9.2.</span> <span class="nav-text">9.2 动态注入CSS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-3-获取当前窗口ID"><span class="nav-number">9.3.</span> <span class="nav-text">9.3 获取当前窗口ID</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-4-获取当前标签页ID"><span class="nav-number">9.4.</span> <span class="nav-text">9.4 获取当前标签页ID</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-5-本地存储"><span class="nav-number">9.5.</span> <span class="nav-text">9.5 本地存储</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-6-webRequest"><span class="nav-number">9.6.</span> <span class="nav-text">9.6 webRequest</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-7-API总结"><span class="nav-number">9.7.</span> <span class="nav-text">9.7 API总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-经验总结"><span class="nav-number">10.</span> <span class="nav-text">10. 经验总结</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#10-1-查看已安装插件路径"><span class="nav-number">10.1.</span> <span class="nav-text">10.1 查看已安装插件路径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-2-特别注意background的报错"><span class="nav-number">10.2.</span> <span class="nav-text">10.2 特别注意background的报错</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#11-打包与发布"><span class="nav-number">11.</span> <span class="nav-text">11. 打包与发布</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#12-参考"><span class="nav-number">12.</span> <span class="nav-text">12. 参考</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#官方资料"><span class="nav-number">12.1.</span> <span class="nav-text">官方资料</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chrome扩展demo"><span class="nav-number">13.</span> <span class="nav-text">Chrome扩展demo</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="king"
      src="/images/tx.jpg">
  <p class="site-author-name" itemprop="name">king</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">67</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">47</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/RocWangPeng" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;RocWangPeng" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:383557980@qq.com" title="E-Mail → mailto:383557980@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2015 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">king</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">450k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">6:49</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
